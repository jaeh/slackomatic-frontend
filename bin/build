#!/bin/bash
#move to app root directory
cd /home/pi/nodejs/;

#compile ecmascript7 to es5
node_modules/.bin/babel src/ --out-dir dist/ --experimental --source-maps

#copy public dir to dist
cp public dist -r
#remove css directory from dist, stylus will add it again
rm dist/public/css/* -r
#remove js directory from dist, browserify will add it again
rm dist/public/js/* -r

#compile client side js
node_modules/.bin/browserify public/js/ --outfile dist/public/js/main.js -t babelify

#compile css files
node_modules/.bin/stylus \
  public/css/slackomatic.styl \
  --import node_modules/nib/ \
  --out dist/public/css/slackomatic.css

#compile html files
node_modules/.bin/jade views/static/* --out dist/static/

#make view dir in dist
mkdir dist/views/ -p
#copy views to serve with jade if html files do not exist 
cp views/* dist/views/ -r
#copy static pages from static to pages directory
mv dist/views/static/* dist/views/pages/
#remove static directory
rm dist/views/static -r


#create log directory for node app if not exists
mkdir dist/log -p
